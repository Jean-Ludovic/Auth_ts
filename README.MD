# üîê Auth Platform

> A full-stack authentication system built with FastAPI and React

A modern, production-ready authentication platform featuring secure token management, email verification, password recovery, and an admin dashboard.

---

## ‚ú® Features

### üîë Authentication
- **Email/Password Login** ‚Äî Secure user authentication
- **Email Verification** ‚Äî 4-digit code verification system
- **Token Management** ‚Äî Refresh tokens in HttpOnly cookies, access tokens in memory
- **Password Recovery** ‚Äî Complete forgot/reset password flow
- **Auto-refresh** ‚Äî Seamless token renewal without user intervention

### üë®‚Äçüíº Administration
- **User Management** ‚Äî View and manage all registered users
- **Analytics Dashboard** ‚Äî Visual signup trends with interactive charts
- **Role-based Access** ‚Äî Admin allowlist and role-based permissions

---

## üõ†Ô∏è Tech Stack

### Backend
- **[FastAPI](https://fastapi.tiangolo.com/)** ‚Äî Modern Python web framework
- **[SQLModel](https://sqlmodel.tiangolo.com/)** ‚Äî SQL databases with Python type annotations
- **[Pydantic](https://docs.pydantic.dev/)** ‚Äî Data validation using Python type hints
- **JWT** ‚Äî Secure access and refresh token implementation
- **SMTP** ‚Äî Email delivery for verification and password reset

### Frontend
- **[React](https://react.dev/)** ‚Äî UI library
- **[Vite](https://vitejs.dev/)** ‚Äî Next-generation frontend tooling
- **[TypeScript](https://www.typescriptlang.org/)** ‚Äî Type-safe JavaScript
- **[TanStack Query](https://tanstack.com/query)** ‚Äî Powerful data synchronization
- **[Zustand](https://zustand-demo.pmnd.rs/)** ‚Äî Lightweight state management
- **[shadcn/ui](https://ui.shadcn.com/)** ‚Äî Beautiful component library
- **[Recharts](https://recharts.org/)** ‚Äî Composable charting library

---

## üìÅ Project Structure

```
.
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py          # FastAPI app entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py        # Environment configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # Authentication routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py         # Admin routes & logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py        # Database models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.py            # Database connection
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py      # JWT & security utilities
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ .env                 # Backend configuration
‚îÇ
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ api/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts      # Auth API calls
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.ts     # Admin API calls
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ password.ts  # Password reset API
    ‚îÇ   ‚îú‚îÄ‚îÄ pages/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminDashboardPage.tsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îú‚îÄ‚îÄ package.json
    ‚îî‚îÄ‚îÄ .env                 # Frontend configuration
```

---

## üöÄ Getting Started

### Prerequisites

- **Python 3.8+**
- **Node.js 16+**
- **npm or yarn**

### 1Ô∏è‚É£ Backend Setup

#### Install Dependencies

```bash
cd backend

# Create virtual environment
python -m venv venv

# Activate virtual environment
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# Install packages
pip install -r requirements.txt
```

#### Configure Environment

Create `backend/.env`:

```env
# Database
DATABASE_URL=sqlite:///./app.db

# CORS
FRONTEND_ORIGIN=http://localhost:3000
COOKIE_SECURE=false

# JWT Configuration
JWT_SECRET=your-super-secret-key-change-this-in-production
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=14

# Admin Access Control (JSON array format!)
ADMIN_EMAILS=["ludoludo2712@outlook.com"]

# SMTP Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
FROM_EMAIL=noreply@yourapp.com

# Password Reset
FRONTEND_RESET_PASSWORD_URL=http://localhost:3000/reset-password
PASSWORD_RESET_EXPIRE_MINUTES=30
```

#### Run the Server

```bash
python -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

**API Documentation:** http://127.0.0.1:8000/docs

### 2Ô∏è‚É£ Frontend Setup

#### Install Dependencies

```bash
cd frontend
npm install
```

#### Configure Environment

Create `frontend/.env`:

```env
VITE_API_BASE_URL=http://127.0.0.1:8000/api

# Optional: Frontend admin allowlist validation
# VITE_ADMIN_EMAILS=ludoludo2712@outlook.com
```

#### Run Development Server

```bash
npm run dev
```

**Application:** http://localhost:3000

---

## üîÑ Authentication Flow

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    participant Database

    User->>Frontend: Login (email/password)
    Frontend->>Backend: POST /api/auth/login
    Backend->>Database: Verify credentials
    Database-->>Backend: User data
    Backend-->>Frontend: accessToken + HttpOnly cookie (refreshToken)
    Frontend->>Frontend: Store accessToken in memory
    
    Note over Frontend,Backend: Token expires after 15 minutes
    
    Frontend->>Backend: GET /api/protected (accessToken expired)
    Backend-->>Frontend: 401 Unauthorized
    Frontend->>Backend: POST /api/auth/refresh (with cookie)
    Backend-->>Frontend: New accessToken
    Frontend->>Backend: Retry request with new token
```

### Key Points

- **Access Token**: Stored in memory (never in localStorage)
- **Refresh Token**: HttpOnly cookie (protected from XSS)
- **Auto-refresh**: Automatically renews tokens when expired
- **Session persistence**: Survives page refreshes via refresh token

---

## üëë Admin Dashboard

### API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/admin/users` | List all users |
| `GET` | `/api/admin/stats/signups?days=30` | Get signup statistics |

### Access Control

Admins are authorized if **either** condition is met:

1. `user.role == "admin"` (database role)
2. `user.email` in `ADMIN_EMAILS` allowlist (recommended for development)

### Frontend Route

- **Admin Dashboard**: `/admin`

---

## ‚ö†Ô∏è Common Issues & Solutions

### 1. Admin Emails Parsing Error

**Problem**: Backend fails to parse `ADMIN_EMAILS`

**Solution**: Ensure it's valid JSON in `.env`

```env
‚úÖ Correct:
ADMIN_EMAILS=["alice@example.com","bob@example.com"]

‚ùå Wrong:
ADMIN_EMAILS=alice@example.com,bob@example.com
```

### 2. 404 on `/api/admin/*` endpoints

**Problem**: Admin routes not found

**Solution**: Verify router is included in `main.py`:

```python
from app.admin import admin_router

app.include_router(admin_router)
```

### 3. Token Lost After Page Refresh

**Problem**: User logged out after refresh

**Explanation**: Access token is stored in memory only. The app automatically:
1. Detects missing access token
2. Calls `/api/auth/refresh` using the HttpOnly cookie
3. Obtains new access token
4. Re-fetches user data

**Solution**: Ensure your frontend implements auto-refresh logic properly.

### 4. SMTP Authentication Failed

**Problem**: Email sending fails

**Solutions**:
- For Gmail: Use [App Passwords](https://support.google.com/accounts/answer/185833)
- Enable "Less secure app access" (not recommended)
- Check SMTP credentials in `.env`

---

## üìú Available Scripts

### Backend

```bash
# Development server with auto-reload
python -m uvicorn app.main:app --reload

# Production server
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### Frontend

```bash
# Development server
npm run dev

# Production build
npm run build

# Preview production build
npm run preview

# Type checking
npm run type-check

# Linting
npm run lint
```

---

## üîí Security Best Practices

- ‚úÖ Refresh tokens in HttpOnly cookies (XSS protection)
- ‚úÖ Access tokens in memory only (no localStorage)
- ‚úÖ CORS properly configured
- ‚úÖ Password hashing (bcrypt/argon2)
- ‚úÖ Email verification before full access
- ‚úÖ Rate limiting on sensitive endpoints (recommended)
- ‚úÖ HTTPS in production (`COOKIE_SECURE=true`)

---

## üö¢ Production Deployment Checklist

- [ ] Set `COOKIE_SECURE=true` in backend `.env`
- [ ] Generate strong `JWT_SECRET` (use `openssl rand -hex 32`)
- [ ] Use PostgreSQL instead of SQLite
- [ ] Configure production SMTP service
- [ ] Enable HTTPS/SSL certificates
- [ ] Set proper CORS origins
- [ ] Implement rate limiting
- [ ] Add logging and monitoring
- [ ] Set up database backups
- [ ] Review admin allowlist

---

## üìù License

MIT License - feel free to use this project for personal or commercial purposes.

---

## ü§ù Contributing

Contributions, issues, and feature requests are welcome!

1. Fork the project
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

---

## üìß Support

For questions or issues:
- Open an issue on GitHub
- Email: ludoludo2712@outlook.com

---

<div align="center">
  Made with ‚ù§Ô∏è using FastAPI and React
</div>